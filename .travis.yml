sudo: enabled
dist: trusty
language: node_js
node_js:
- lts/*
services:
- mongodb
before_script:
- sleep 5
- cd app
env:
- MONGO_CONTAINER=localhost MONGO_PORT=27017 DB_NAME=lazyJar
script:
- npm install && npm test
before_install:
- cd ${TRAVIS_BUILD_DIR}
- openssl aes-256-cbc -K $encrypted_a8e9febd254e_key -iv $encrypted_a8e9febd254e_iv
  -in secrets.tar.enc -out secrets.tar -d
- tar -xvf secrets.tar
after_install:
- echo 1
- mv secrets/mongo/mongo.key.json mongo/
- echo 2
- mv secrets/deploy.key.json ${TRAVIS_BUILD_DIR}
before_deploy:
- echo 03
- export CLOUD_SDK_REPO="cloud-sdk-$(lsb_release -c -s)"
- echo "deb http://packages.cloud.google.com/apt $CLOUD_SDK_REPO main" | tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
- curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
- apt-get update && apt-get install -y \
	google-cloud-sdk 
- apt-get autoremove && apt-get clean
- echo 04
- source /home/travis/google-cloud-sdk/path.bash.inc
- echo 5
deploy:
- provider: script
  script: "scripts/deploy.sh"
  skip_cleanup: true
  on:
    branch: docker
